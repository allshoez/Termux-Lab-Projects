#!/data/data/com.termux/files/usr/bin/bash

# Warna ANSI
RED="\033[0;31m"
GREEN="\033[0;32m"
YELLOW="\033[1;33m"
BLUE="\033[0;34m"
PURPLE="\033[0;35m"
CYAN="\033[0;36m"
RESET="\033[0m"

while true; do
    clear
    echo -e "${RED}=== ${GREEN}MULTI ${YELLOW}PLATFORM ${BLUE}DOWNLOADER ${PURPLE}TERMUX ===${RESET}"
    echo -e "${YELLOW}1. YouTube Video (best)${RESET}"
    echo -e "${YELLOW}2. YouTube Audio (MP3)${RESET}"
    echo -e "${YELLOW}3. YouTube Video Resolusi tertentu${RESET}"
    echo -e "${YELLOW}4. YouTube Playlist${RESET}"
    echo -e "${YELLOW}5. TikTok Video / Audio${RESET}"
    echo -e "${YELLOW}6. Streaming / Tapepops / Streamtape / m3u8${RESET}"
    echo -e "${YELLOW}7. Update yt-dlp${RESET}"
    echo -e "${YELLOW}8. IG / Facebook Video / Audio${RESET}"
    echo -e "${YELLOW}X. Keluar${RESET}"

    read -p "‚û°Ô∏è Pilih menu: " menu

    case $menu in
        1)
            read -p "Masukkan URL YouTube: " url
            yt-dlp -o "/sdcard/Download/%(title)s.%(ext)s" -f best "$url"
            read -p "[‚úî] Selesai... tekan Enter"
            ;;
        2)
            read -p "Masukkan URL YouTube: " url
            yt-dlp -o "/sdcard/Download/%(title)s.%(ext)s" -f bestaudio --extract-audio --audio-format mp3 "$url"
            read -p "[‚úî] Selesai... tekan Enter"
            ;;
        3)
            read -p "Masukkan URL YouTube: " url
            echo -e "${YELLOW}Pilih resolusi video:${RESET}"
            echo -e "${YELLOW}1. 1080p  2. 720p  3. 480p  4. 360p  5. 240p${RESET}"
            read -p "‚û°Ô∏è Pilih: " res
            case $res in
                1) fmt="bestvideo[height<=1080]+bestaudio/best[height<=1080]" ;;
                2) fmt="bestvideo[height<=720]+bestaudio/best[height<=720]" ;;
                3) fmt="bestvideo[height<=480]+bestaudio/best[height<=480]" ;;
                4) fmt="bestvideo[height<=360]+bestaudio/best[height<=360]" ;;
                5) fmt="bestvideo[height<=240]+bestaudio/best[height<=240]" ;;
                *) echo -e "${RED}[!] Pilihan tidak valid!${RESET}"; sleep 1; continue ;;
            esac
            yt-dlp -o "/sdcard/Download/%(title)s.%(ext)s" -f "$fmt" "$url"
            read -p "[‚úî] Selesai... tekan Enter"
            ;;
        4)
            read -p "Masukkan URL Playlist YouTube: " url
            yt-dlp -o "/sdcard/Download/%(playlist_title)s/%(title)s.%(ext)s" "$url"
            read -p "[‚úî] Playlist selesai di-download... tekan Enter"
            ;;
        5)
            read -p "Masukkan URL TikTok: " url
            echo -e "${YELLOW}Pilih format download:${RESET}"
            echo -e "${YELLOW}1. Video (MP4)  2. Audio (MP3)${RESET}"
            read -p "‚û°Ô∏è Pilih: " ftype
            case $ftype in
                1) yt-dlp -o "/sdcard/Download/%(title)s.%(ext)s" "$url" ;;
                2) yt-dlp -o "/sdcard/Download/%(title)s.%(ext)s" -f bestaudio --extract-audio --audio-format mp3 "$url" ;;
                *) echo -e "${RED}[!] Pilihan tidak valid!${RESET}"; sleep 1; continue ;;
            esac
            read -p "[‚úî] TikTok selesai... tekan Enter"
            ;;
        6)
            echo -e "${CYAN}Masukkan URL MP4 / m3u8 / Tapepops / Streamtape, satu per baris.${RESET}"
            echo -e "${CYAN}Kosongkan untuk selesai input, X untuk keluar script.${RESET}"
            STREAMS=()
            while true; do
                read -p "> " line
                [[ "$line" =~ ^[Xx]$ ]] && exit 0
                [[ -z "$line" ]] && break
                STREAMS+=("$line")
            done

            if [ ${#STREAMS[@]} -eq 0 ]; then
                echo -e "${RED}[!] Tidak ada URL dimasukkan${RESET}"
                read -p "Tekan Enter untuk kembali ke menu"
                continue
            fi

            echo -e "${YELLOW}Pilih format output:${RESET}"
            echo -e "${YELLOW}1. Video MP4  2. Audio MP3${RESET}"
            read -p "‚û°Ô∏è Pilih: " fmt_out

            echo -e "${YELLOW}Pilih resolusi / audio quality (default 320p / 128k):${RESET}"
            echo -e "${YELLOW}1. 240p  2. 320p  3. 480p  4. 720p${RESET}"
            read -p "‚û°Ô∏è Pilih: " r
            case $r in
                1) H=240 ;;
                2) H=320 ;;
                3) H=480 ;;
                4) H=720 ;;
                *) H=320 ;;
            esac

            for S in "${STREAMS[@]}"; do
                F="/sdcard/Download/stream_$(date +%s).mp4"

                if [[ "$S" =~ \.mp4 ]] || [[ "$S" =~ "get_video" ]]; then
                    echo "[*] Download MP4 ‚Üí $F"
                    curl -L -A "Mozilla/5.0" "$S" -o "$F" || { echo "[!] Download gagal"; continue; }

                elif [[ "$S" =~ \.m3u8 ]]; then
                    echo "[*] m3u8 detected, converting ‚Üí $F"
                    ffmpeg -i "$S" -vf "scale=-2:$H" -c:a copy "$F" || { echo "[!] Convert gagal"; continue; }

                else
                    echo -e "${RED}[!] URL tidak didukung, lewati${RESET}"
                    continue
                fi

                if [[ "$fmt_out" == "2" ]]; then
                    FOUT="/sdcard/Download/stream_$(date +%s).mp3"
                    ffmpeg -i "$F" -vn -ab 128k "$FOUT" && rm "$F"
                    echo "[‚úî] Selesai MP3: $FOUT"
                else
                    FOUT="/sdcard/Download/stream_$(date +%s)_${H}p.mp4"
                    ffmpeg -i "$F" -vf "scale=-2:$H" -c:a copy "$FOUT" && rm "$F"
                    echo "[‚úî] Selesai MP4: $FOUT"
                fi
            done
            read -p "Tekan Enter untuk kembali ke menu"
            ;;
        7)
            echo -e "${CYAN}[üîÑ] Updating yt-dlp...${RESET}"
            pip install -U yt-dlp
            echo -e "${GREEN}[‚úî] Update selesai!${RESET}"
            read -p "Tekan Enter untuk kembali ke menu"
            ;;
        8)
            read -p "Masukkan URL IG / Facebook: " url
            echo -e "${YELLOW}Pilih format download:${RESET}"
            echo -e "${YELLOW}1. Video (MP4)  2. Audio (MP3)${RESET}"
            read -p "‚û°Ô∏è Pilih: " ftype
            case $ftype in
                1) yt-dlp -o "/sdcard/Download/%(title)s.%(ext)s" "$url" ;;
                2) yt-dlp -o "/sdcard/Download/%(title)s.%(ext)s" -f bestaudio --extract-audio --audio-format mp3 "$url" ;;
                *) echo -e "${RED}[!] Pilihan tidak valid!${RESET}"; sleep 1; continue ;;
            esac
            read -p "[‚úî] IG / FB selesai... tekan Enter"
            ;;
        x|X)
            echo -e "${GREEN}[‚úî] Keluar...${RESET}"
            exit 0
            ;;
        *)
            echo -e "${RED}[!] Pilihan tidak valid!${RESET}"
            sleep 1
            ;;
    esac
done